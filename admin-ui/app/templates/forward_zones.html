{% extends "base.html" %}
{% block content %}
  <div class="flex items-end justify-between">
    <div>
      <h1 class="text-xl font-semibold">Forward Zones</h1>
      <p class="mt-1 text-sm text-slate-400">Configure domain-specific DNS resolution (e.g., internal.company.com â†’ 192.168.1.10)</p>
    </div>
    <form method="post" action="/forwardzones/apply">
      {{ csrf_input(request) }}
      <button class="rounded-lg bg-gradient-to-r from-indigo-500 to-cyan-500 px-4 py-2 text-sm font-medium text-slate-950" type="submit">Apply (generate forward-zones.conf)</button>
    </form>
  </div>

  {% if message %}
  <div class="mt-4 rounded-lg border border-slate-700 bg-bg-800 px-3 py-2 text-sm text-slate-200">{{ message }}</div>
  {% endif %}

  <div class="mt-4 rounded-2xl border border-slate-800 bg-bg-800 p-5">
    <h2 class="text-sm font-semibold text-slate-200">Add forward zone</h2>
    <form class="mt-3 space-y-3" method="post" action="/forwardzones/add">
      {{ csrf_input(request) }}
      <div>
        <label class="text-sm text-slate-300">Domain</label>
        <input class="mt-1 w-full rounded-lg border border-slate-700 bg-bg-900 px-3 py-2" name="domain" placeholder="internal.company.com" required />
      </div>
      <div>
        <label class="text-sm text-slate-300">DNS servers (comma-separated)</label>
        <input class="mt-1 w-full rounded-lg border border-slate-700 bg-bg-900 px-3 py-2" name="servers" placeholder="192.168.1.10,192.168.1.11" required />
      </div>
      <div>
        <label class="flex items-center gap-2 text-sm text-slate-300 cursor-pointer">
          <input type="checkbox" name="apply_globally" value="true" checked class="rounded bg-bg-900 border border-slate-700" />
          Apply to all nodes (global)
        </label>
      </div>
      <div>
        <label class="text-sm text-slate-300">Node (if not global)</label>
        <select class="mt-1 w-full rounded-lg border border-slate-700 bg-bg-900 px-3 py-2" name="node_id">
          <option value="">-- Select Node --</option>
          {% for node in nodes %}
          <option value="{{ node.id }}">{{ node.name }}</option>
          {% endfor %}
        </select>
      </div>
      <button class="rounded-lg border border-slate-700 bg-bg-900 px-3 py-2 text-sm hover:bg-bg-700" type="submit">Add zone</button>
    </form>
  </div>

  <div class="mt-4 rounded-2xl border border-amber-800/50 bg-amber-900/20 p-5">
    <div class="flex items-start gap-3">
      <div class="text-amber-400 text-xl">ðŸ’¡</div>
      <div>
        <h2 class="text-sm font-semibold text-amber-200">Local Network Host Names (PTR Records)</h2>
        <p class="mt-1 text-sm text-slate-300">
          To resolve client IP addresses to hostnames in the query logs, configure a reverse DNS zone pointing to your router or local DNS server.
        </p>
        <div class="mt-3 text-sm text-slate-400">
          <p class="font-medium text-slate-300">Common examples:</p>
          <ul class="mt-2 space-y-1 list-disc list-inside">
            <li><code class="bg-bg-900 px-1 rounded">168.192.in-addr.arpa</code> â†’ <code class="bg-bg-900 px-1 rounded">192.168.1.1</code> (covers 192.168.x.x)</li>
            <li><code class="bg-bg-900 px-1 rounded">10.in-addr.arpa</code> â†’ <code class="bg-bg-900 px-1 rounded">10.0.0.1</code> (covers 10.x.x.x)</li>
            <li><code class="bg-bg-900 px-1 rounded">16.172.in-addr.arpa</code> â†’ <code class="bg-bg-900 px-1 rounded">172.16.0.1</code> (covers 172.16.x.x)</li>
          </ul>
        </div>
        <p class="mt-3 text-xs text-slate-500">
          Your router must serve PTR records for DHCP clients. Also configure <a href="/clients/resolver" class="text-cyan-400 hover:underline">Client Resolver Rules</a> for the UI to display hostnames.
        </p>
      </div>
    </div>
  </div>

  {% if global_zones %}
  <div class="mt-4 overflow-hidden rounded-2xl border border-slate-800 bg-bg-800">
    <div class="bg-bg-900 px-4 py-2 text-sm font-semibold text-slate-200">Global zones</div>
    <table class="min-w-full text-sm">
      <thead class="bg-bg-900 text-slate-300">
        <tr>
          <th class="px-4 py-3 text-left">Domain</th>
          <th class="px-4 py-3 text-left">Servers</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800">
        {% for z in global_zones %}
        <tr class="hover:bg-bg-700">
          <td class="px-4 py-3 text-slate-200 font-mono">{{ z.domain }}</td>
          <td class="px-4 py-3 text-slate-300">{{ z.servers }}</td>
          <td class="px-4 py-3 text-right space-x-2">
            <form method="post" action="/forwardzones/toggle" class="inline">
              {{ csrf_input(request) }}
              <input type="hidden" name="id" value="{{ z.id }}" />
              <button class="rounded-md border border-slate-700 bg-bg-900 px-2 py-1 text-xs hover:bg-bg-700" type="submit">{% if z.enabled %}off{% else %}on{% endif %}</button>
            </form>
            <form method="post" action="/forwardzones/delete" class="inline">
              {{ csrf_input(request) }}
              <input type="hidden" name="id" value="{{ z.id }}" />
              <button type="submit" class="rounded-md border border-slate-700 bg-bg-900 px-2 py-1 text-xs hover:bg-bg-700">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  {% if per_node_zones %}
  <div class="mt-4 overflow-hidden rounded-2xl border border-slate-800 bg-bg-800">
    <div class="bg-bg-900 px-4 py-2 text-sm font-semibold text-slate-200">Per-node zones</div>
    <table class="min-w-full text-sm">
      <thead class="bg-bg-900 text-slate-300">
        <tr>
          <th class="px-4 py-3 text-left">Domain</th>
          <th class="px-4 py-3 text-left">Servers</th>
          <th class="px-4 py-3 text-left">Node</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800">
        {% for z in per_node_zones %}
        <tr class="hover:bg-bg-700">
          <td class="px-4 py-3 text-slate-200 font-mono">{{ z.domain }}</td>
          <td class="px-4 py-3 text-slate-300">{{ z.servers }}</td>
          <td class="px-4 py-3 text-slate-400">{{ z.node.name if z.node else '-' }}</td>
          <td class="px-4 py-3 text-right space-x-2">
            <form method="post" action="/forwardzones/toggle" class="inline">
              {{ csrf_input(request) }}
              <input type="hidden" name="id" value="{{ z.id }}" />
              <button class="rounded-md border border-slate-700 bg-bg-900 px-2 py-1 text-xs hover:bg-bg-700" type="submit">{% if z.enabled %}off{% else %}on{% endif %}</button>
            </form>
            <form method="post" action="/forwardzones/delete" class="inline">
              {{ csrf_input(request) }}
              <input type="hidden" name="id" value="{{ z.id }}" />
              <button type="submit" class="rounded-md border border-slate-700 bg-bg-900 px-2 py-1 text-xs hover:bg-bg-700">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
{% endblock %}