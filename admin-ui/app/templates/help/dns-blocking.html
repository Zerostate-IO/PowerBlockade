{% extends "base.html" %}
{% block content %}
  <h1 class="text-xl font-semibold">DNS Blocking & RPZ</h1>
  <p class="mt-1 text-sm text-slate-400">How PowerBlockade filters DNS queries to block unwanted domains.</p>

  <div class="mt-6 space-y-6">
    <div class="rounded-2xl border border-slate-800 bg-bg-800 p-6">
      <h2 class="text-lg font-semibold text-slate-200">What is DNS blocking?</h2>
      <p class="mt-2 text-sm text-slate-300">
        DNS blocking intercepts DNS queries and returns an error response (NXDOMAIN or REFUSED) for domains that you've chosen to block. This prevents traffic from reaching those domains entirely.
      </p>
      <p class="mt-2 text-sm text-slate-300">
        Unlike firewall or content filtering, DNS blocking works at the DNS resolution layer‚Äîit's fast, efficient, and applies network-wide when clients use your DNS server.
      </p>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-bg-800 p-6">
      <h2 class="text-lg font-semibold text-slate-200">How blocklists work</h2>
      <p class="mt-2 text-sm text-slate-300">
        PowerBlockade uses <em>RPZ (Response Policy Zones)</em>, which is a standard DNS mechanism for blocking domains. Here's the flow:
      </p>
      <ol class="mt-3 list-decimal pl-5 text-sm text-slate-300 space-y-2">
        <li>You add blocklist sources (URLs in various formats: hosts, domains, adblock-style)</li>
        <li>Click <strong>Apply</strong> to download and parse all blocklists</li>
        <li>PowerBlockade generates RPZ zone files in <code class="bg-bg-900 px-1 rounded">/shared/rpz/</code></li>
        <li>PowerDNS Recursor (the DNS engine) detects zone file changes and reloads them within ~5 seconds</li>
        <li>All matching queries are now blocked</li>
      </ol>
      <p class="mt-3 text-sm text-slate-400">
        üí° The recursor-reloader sidecar monitors for RPZ changes and runs <code class="bg-bg-900 px-1 rounded">rec_control reload-zones</code> automatically.
      </p>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-bg-800 p-6">
      <h2 class="text-lg font-semibold text-slate-200">Blocklist formats</h2>
      <p class="mt-2 text-sm text-slate-300">PowerBlockade supports multiple blocklist formats:</p>
      <ul class="mt-3 list-disc pl-5 text-sm text-slate-300 space-y-1">
        <li><strong>hosts</strong> ‚Äì Standard /etc/hosts format: <code class="bg-bg-900 px-1 rounded">0.0.0.0 example.com</code></li>
        <li><strong>domains</strong> ‚Äì Plain domain list, one per line</li>
        <li><strong>adblock</strong> ‚Äì AdBlock-style patterns (may include wildcards)</li>
      </ul>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-bg-800 p-6">
      <h2 class="text-lg font-semibold text-slate-200">Suggested blocklists</h2>
      <p class="mt-2 text-sm text-slate-300">The <strong>Suggested Lists</strong> tab provides curated recommendations:</p>
      <ul class="mt-3 list-disc pl-5 text-sm text-slate-300 space-y-1">
        <li><strong>Ads</strong> ‚Äì Ad/tracker domains (e.g. StevenBlack/hosts)</li>
        <li><strong>Malware</strong> ‚Äì Known malicious domains</li>
        <li><strong>Telemetry</strong> ‚Äì Telemetry/surveillance domains</li>
        <li><strong>Adult content</strong> ‚Äì Optional, conservative lists available</li>
      </ul>
      <div class="mt-3 rounded-lg border border-amber-500/30 bg-amber-500/10 p-3">
        <p class="text-sm text-amber-200">
          ‚ö†Ô∏è <strong>Start conservative:</strong> Begin with ads + malware. Add telemetry and adult lists gradually to verify they don't break anything important.
        </p>
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-bg-800 p-6">
      <h2 class="text-lg font-semibold text-slate-200">Why not OpenSearch for MVP?</h2>
      <p class="mt-2 text-sm text-slate-300">
        The original design used OpenSearch for long-term query storage, but this was deferred for MVP 0.0.1 to reduce resource requirements‚Äîespecially important when running on resource-constrained hardware like Raspberry Pi or VPS.
      </p>
      <p class="mt-2 text-sm text-slate-300">
        For MVP 0.0.1, all DNS query events go directly to Postgres. This provides sufficient storage for recent history and analytics without requiring additional infrastructure.
      </p>
    </div>

    <a class="inline-flex items-center gap-2 text-sm text-indigo-400 hover:text-indigo-300" href="/blocklists">‚Üí Go to Blocklists</a>
  </div>
{% endblock %}