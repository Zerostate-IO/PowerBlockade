{% extends "base.html" %}
{% block content %}
  <div class="space-y-6">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-semibold">System Health</h1>
      <div class="text-sm text-slate-400">
        <span class="inline-block w-2 h-2 rounded-full bg-emerald-400 mr-1"></span>
        {{ nodes|length }} node{{ 's' if nodes|length != 1 else '' }} active
      </div>
    </div>

    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {% for item in nodes %}
      <div class="rounded-xl border border-slate-800 bg-bg-800 p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-slate-100">{{ item.node.name }}</h3>
          <span class="px-2 py-0.5 text-xs rounded-full bg-emerald-900 text-emerald-300">active</span>
        </div>
        {% if item.metrics %}
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-slate-400">Cache Hit Rate</span>
            {% set total = item.metrics.cache_hits + item.metrics.cache_misses %}
            {% set rate = (item.metrics.cache_hits / total * 100) if total > 0 else 0 %}
            <span class="text-slate-100">{{ "%.1f"|format(rate) }}%</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Cache Entries</span>
            <span class="text-slate-100">{{ "{:,}".format(item.metrics.cache_entries) }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Questions</span>
            <span class="text-slate-100">{{ "{:,}".format(item.metrics.questions) }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Uptime</span>
            {% set days = item.metrics.uptime_seconds // 86400 %}
            {% set hours = (item.metrics.uptime_seconds % 86400) // 3600 %}
            <span class="text-slate-100">{{ days }}d {{ hours }}h</span>
          </div>
        </div>
        {% else %}
        <p class="text-sm text-slate-500">No metrics data yet</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <div class="rounded-xl border border-slate-800 bg-bg-800 overflow-hidden">
      <div class="px-5 py-3 border-b border-slate-800">
        <h2 class="font-semibold text-slate-100">Performance Dashboard</h2>
        <p class="text-xs text-slate-400 mt-1">Real-time metrics from all nodes</p>
      </div>
      <div class="relative" style="padding-bottom: 56.25%; min-height: 500px;">
        <iframe 
          src="/grafana/d/powerblockade-health/system-health?orgId=1&kiosk=tv&theme=dark"
          class="absolute inset-0 w-full h-full border-0"
          loading="lazy"
        ></iframe>
      </div>
    </div>
  </div>
{% endblock %}
